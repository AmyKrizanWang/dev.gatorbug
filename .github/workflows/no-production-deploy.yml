name: DevEnv Protection

on:
  push:
    branches: ["*"]
  pull_request:
    branches: ["*"]

permissions:
  contents: read

jobs:
  check-environment:
    name: Verify DevEnv - No Production Deployments
    runs-on: ubuntu-latest
    steps:
      - name: DevEnv Notice
        run: |
          echo "=========================================="
          echo "This is a DevEnv for testing plugins and extensions."
          echo "No production deployments are allowed from this environment."
          echo "All changes must pass QA in StageEnv before production deployment."
          echo "=========================================="

      - name: Block Production Deploy (Push)
        if: github.event_name == 'push' && (contains(github.event.head_commit.message, '[deploy-prod]') || contains(github.event.head_commit.message, '[production]'))
        run: |
          echo "ERROR: Production deployments are not allowed from DevEnv!"
          echo "Please ensure your changes pass QA in StageEnv first."
          exit 1

      - name: Block Production Deploy (PR)
        if: github.event_name == 'pull_request' && (contains(github.event.pull_request.title, '[deploy-prod]') || contains(github.event.pull_request.title, '[production]'))
        run: |
          echo "ERROR: Production deployments are not allowed from DevEnv!"
          echo "Please ensure your changes pass QA in StageEnv first."
          exit 1
